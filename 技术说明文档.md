# **Study Quest游戏化学习系统技术文档（最终版）**  
**版本**：v3.0  
**目标**：零成本/国内快速访问/最小可行产品  

---

## 一、技术栈最终选择  
### **前端**  
- **框架**：Vue 3 + Composition API + TypeScript 
- **UI库**：Element UI（国内访问快）  
- **游戏引擎**：PixiJS（轻量级2D渲染）  
- **状态管理**：Pinia  
- **动画**：VueUse/motion  
- **打包工具**：Vite  

### **后端**  
- **框架**：FastAPI  
- **数据库**：Supabase中国版（PostgreSQL）  
- **实时通信**：WebSocket (通过Starlette)  
- **API文档**：自动生成Swagger UI  

### **基础设施**  
| 服务类型       | 选用方案                | 免费额度                |  
|----------------|-------------------------|------------------------|  
| **前端托管**   | Vercel（绑定备案域名）  | 100GB/月带宽           |  
| **后端托管**   | Deta Space              | 不限请求数             |  
| **数据库**     | Supabase中国区          | 500MB存储+1万行/天     |  
| **CDN加速**    | Cloudflare中国合作节点  | 基础加速免费           |  

---

## 二、核心功能实现方案  
### 1. **游戏化任务系统**  
```vue
<!-- 任务卡片组件 -->  
<template>  
  <div class="quest" @click="startQuest">  
    <h3>{{ task.name }}</h3>  
    <p>奖励: {{ task.reward }}金币</p>  
    <progress :value="progress" max="100"></progress>  
  </div>  
</template>  

<script setup>  
import { useGameStore } from '@/stores/game'  
const game = useGameStore()  
</script>  
```

### 2. **实时排行榜**  
```python  
# FastAPI WebSocket实现  
@app.websocket("/ws/rank")  
async def websocket_rank(websocket: WebSocket):  
    await websocket.accept()  
    while True:  
        data = get_live_rank()  # 从Supabase获取  
        await websocket.send_json(data)  
        await asyncio.sleep(10)  # 10秒更新一次  
```

### 3. **金币兑换系统**  
```sql  
-- Supabase数据库表设计  
create table user_balance (  
  user_id uuid primary key,  
  coins integer default 0,  
  last_claim timestamp  
);  
```

---

## 三、从零开始部署路径  
### **1. 开发准备（1天）**  
| 步骤                | 操作指南                                                                 |  
|---------------------|--------------------------------------------------------------------------|  
| **注册账号**        | 完成Vercel/Deta/Supabase/Cloudflare账号注册                              |  
| **安装工具**        | VS Code + Git + Node.js 18 + Python 3.10                                 |  
| **克隆模板项目**    | `git clone https://github.com/sample/study-quest-vue-fastapi-starter.git` |  

### **2. 本地开发（1-2周）**  
```bash  
# 前端启动  
cd frontend && npm install && npm run dev  

# 后端启动  
cd backend && pip install -r requirements.txt  
uvicorn main:app --reload  
```

### **3. 部署上线（1天）**  
```bash  
# 前端部署到Vercel  
npm install -g vercel  
vercel --prod  

# 后端部署到Deta  
deta new --python study-quest-api  
deta deploy  
```

---

## 四、避坑指南  
1. **域名备案**：使用腾讯云/阿里云免费域名（需3-20天备案周期）  
2. **数据安全**：Supabase务必开启RLS（行级安全）  
3. **微信分享**：需配置ICP备案域名才能调用JS-SDK  

---

## 五、零成本监控方案  
```python  
# 简易健康检查脚本（可部署到Deta Cron）  
import requests  
def check_services():  
    services = {  
        "前端": "https://your-vercel-app.vercel.app/health",  
        "API": "https://your-deta-app.deta.app/ping",  
        "数据库": supabase.rpc('ping')  
    }  
    for name, resp in services.items():  
        print(f"{name}状态: {'正常' if resp.ok else '异常'}")  
```
